# 1. DSLクエリドキュメント

Elasticsearchのクエリは **JSONスタイルのDSL（Domain Specific Language）** を使用して実現されます。

## 1.1. DSLクエリの分類

Elasticsearchは **JSONベースのDSL** を提供し、クエリを定義できます。主なクエリの種類は以下のとおりです。

### 🔹 全件検索（match_all）
すべてのデータを取得するクエリ。通常はテスト用。

#### **例**
```json
GET /indexName/_search
{
  "query": {
    "match_all": {}
  }
}
```
## 1.2. 全文検索クエリ

### 1.2.1. 使用シーン

全文検索クエリの基本的な流れは以下の通りです。

1. **ユーザーの検索内容をトークナイズ** し、トークンを取得  
2. **転置インデックスで一致するドキュメントID** を検索  
3. **ドキュメントIDに基づいてドキュメントを取得** し、ユーザーに返す  

#### **主な使用例**
✅ **ECサイトの検索ボックス**  
✅ **検索エンジンの検索ボックス**（例：Google、Bing）  

---

### 1.2.2. 基本構文

代表的な全文検索クエリは以下の通りです。

🔹 **matchクエリ**：単一フィールド検索  
🔹 **multi_matchクエリ**：複数フィールド検索。いずれかのフィールドが一致すれば検索結果に含まれる  

#### **matchクエリの構文**
```json
GET /indexName/_search
{
  "query": {
    "match": {
      "FIELD": "TEXT"
    }
  }
}
```
#### **multi_matchクエリの構文**
```json
GET /indexName/_search
{
  "query": {
    "multi_match": {
      "query": "TEXT",
      "fields": ["FIELD1", "FIELD2"]
    }
  }
}
```
## 1.3. 精確検索

精確検索は通常、`keyword`、`数値`、`日付`、`boolean` などの型のフィールドに対して行われます。  
そのため、検索条件は **トークナイズされません**。

### 🔹 主なクエリ
- **termクエリ**：指定した単語に **完全一致** するドキュメントを検索  
- **rangeクエリ**：数値や日付の **範囲に基づいた検索**  

---

### 1.3.1. termクエリ（完全一致検索）

精確検索のフィールドは **トークナイズされない** ため、検索条件もそのままの形で検索されます。  
指定した語句と **完全一致する場合のみ** 結果が取得されます。

#### **構文**
```json
GET /indexName/_search
{
  "query": {
    "term": {
      "FIELD": {
        "value": "VALUE"
      }
    }
  }
}
```
### 1.3.2. rangeクエリ（範囲検索）

範囲検索は、**数値や日付などの範囲** を指定してフィルタリングを行う際に使用されます。  
例えば、**価格の範囲検索** などです。

#### **構文**
```json
GET /indexName/_search
{
  "query": {
    "range": {
      "FIELD": {
        "gte": VALUE1,
        "lte": VALUE2
      }
    }
  }
}
```
### 1.3.3. まとめ

🔹 **精確検索の主な種類**  

- **termクエリ**：指定した単語と **完全一致するデータを検索**。  
  通常、`keyword型`、`数値型`、`boolean型`、`日付型` のフィールドに適用

- **rangeクエリ**：**数値や日付の範囲を指定** した検索
